# Divan [![Build Status](https://travis-ci.org/garbados/divan.png)](https://travis-ci.org/garbados/divan) [![Coverage Status](https://coveralls.io/repos/garbados/divan/badge.png)](https://coveralls.io/r/garbados/divan)

An effortless CouchDB ODM for Python.

Put on your favorite hookah, sit back on the [divan][wiki], and relax.

![What a Divan Looks Like][wiki_img]

## Install

    pip install divan
    
## Usage

All methods return response objects generated by Requests.

If CouchDB has a special endpoint for something, it's in Divan as a special method, so any special circumstances are taken care of automagically.

You can create objects explicitly or inherit them from objects higher in the DB heirarchy. So, you can create a `Database` object explicitly, or use `Connection.database` to inherit settings from the `Connection` object

## API

### Connection(uri, **kwargs)

#### Connection.database(name, **kwargs)

### Database(uri, name, **kwargs)

Connection to a specific database

#### Database.merge(docname, change, **kwargs)

Get document by `docname`, merge `changes`, 
and then `PUT` the updated document back to the server

#### Database.attachment(docname, **kwargs)

Create an `Attachment` object from `docname` and the settings
for the current database.

#### Database.get_or_create(doc, **kwargs)

Given a document with an _id attribute, returns it if it exists.

If it doesn't, it tries to create it.

If the doc is None, it tries to get or create the current database instead.

#### Database.changes(, **kwargs)

Gets a list of the changes made to the database. This can be used to monitor for update and modifications to the database for post processing or synchronization.

Automatically adjusts the request to handle the different response behavior of polling, longpolling, and continuous modes.

#### Database.view(docname, **kwargs)

Create a `View` object from `docname` and the settings
for the current database.

### View(uri, name, doc, **kwargs)

Methods for design documents

#### View.query(viewname, **kwargs)

### Attachment(uri, name, doc, **kwargs)

Attachment methods for a single document


## Testing

Testing uses a live database, so you'll need to configure a `local_settings.py` file or set environment variables for `URI`, `DB_NAME`, `USER`, and `PASS`. Then:

    python setup.py test

[wiki]: http://en.wikipedia.org/wiki/Divan_(furniture\)
[wiki_img]: http://upload.wikimedia.org/wikipedia/commons/e/ea/FrancisLevettLiotard.jpg