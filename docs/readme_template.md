# Divan [![Build Status](https://travis-ci.org/garbados/divan.png)](https://travis-ci.org/garbados/divan) [![Coverage Status](https://coveralls.io/repos/garbados/divan/badge.png)](https://coveralls.io/r/garbados/divan)

[wiki]: http://en.wikipedia.org/wiki/Divan_(furniture\)
[wiki_img]: http://upload.wikimedia.org/wikipedia/commons/e/ea/FrancisLevettLiotard.jpg

An effortless Cloudant interface for Python.

Put on your favorite hookah, sit back on the [divan][wiki], and relax.

![What a Divan Looks Like][wiki_img]

## Install

    pip install divan
    
## Usage

Cloudant and CouchDB expose REST APIs that map effortlessly into native Python objects. As much as possible, Divan uses native Python objects as shortcuts to the raw API, so that such convenience never obscures what's going on underneath. For example:

    import divan

    conn = divan.Connection()
    db = conn.database('test')
    same_db = conn['test']
    assert db.uri == same_db.uri
    # True

Divan expose raw interactions -- HTTP requests, etc. -- through special methods, so we provide syntactical sugar without obscuring the underlying API. Built-ins, such as `__getitem__`, act as Pythonic shortcuts to those methods. For example:

    import divan

    conn = divan.Connection()
    db = conn.database('test')
    doc = db.document('test_doc')
    # create the document
    doc.put({
      '_id': 'hello_world',
      'herp': 'derp'
      })
    # delete the document
    doc.delete()
    # but this also creates a document
    db['hello_world'] = {'herp': 'derp'}

If CouchDB has a special endpoint for something, it's in Divan as a special method, so any special circumstances are taken care of automagically. For example:

    import divan

    conn = divan.Connection()
    db = conn.database('test')
    view = db.all_docs() # returns all docs in the database
    for doc in db:
      # iterates over every doc in the database
      pass
    for doc in view:
      # and so does this!
      pass

### Object Hierarchy

You can create objects explicitly or inherit them from objects higher in the DB hierarchy. So, you can create a `Database` object explicitly, or use `Connection.database` to inherit settings from the `Connection` object. For example:

    import divan

    conn = divan.Connection()
    db = conn.database('test')
    doc = db.document('test_doc')
    otherdoc = divan.Document('http://localhost:5984/test/test_doc')
    assert doc.uri == otherdoc.uri
    # True

### Errors

All methods return response objects generated by Requests, if the request was successful. Else, the response object is attached to the thrown error. If a response has a bad status code, Divan throws an error. For example:

    import divan

    conn = divan.Connection()
    # connect to a database that doesn't exist
    db = conn.database('test')
    doc = db.document('doesnotexist')
    doc.put({
      'this_will': 'throw_an_error'
      })
    # throws divan.error.NotFoundError

Where possible, Divan errors inherit from built-in errors, so you can catch them more naturally. To wit:

* `NotFoundError` inherits from `LookupError`
* `BadRequestError` inherits from `SyntaxError`
* `MethodNotAllowedError` inherits from `AttributeError`
* `ConflictError` and `PreconditionError` inherit from `AssertionError`

All Divan errors also inherit from `DivanException`.

## API
{% for class in order %}
{%- set main = docs[class]._main %}
### {{class}}({{main.args}}{% if main.args and main.kwargs%}, {% endif %}{% if main.kwargs %}**{{main.kwargs}}{% endif %})
{{main.docs}}
{%- for name, method in docs[class].items() if name != '_main' %}
#### {{class}}.{{name}}({{method.args}}{% if method.args and method.kwargs%}, {% endif %}{% if method.kwargs %}**{{method.kwargs}}{% endif %})
{{method.docs}}

{%- endfor %}
{%- endfor %}

## Testing

To run Divan's tests, just do:

    python setup.py test

## Documentation

The API reference is automatically generated from the docstrings of each class and its methods. To install Divan with the necessary extensions to build the docs, do this:

    pip install -e divan[docs]

Then, in Divan's root directory, do this:
  
    python docs

Note: docstrings are in [Markdown](http://daringfireball.net/projects/markdown/).

## License

[MIT](http://opensource.org/licenses/MIT), yo.