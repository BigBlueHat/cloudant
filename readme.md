# Divan [![Build Status](https://travis-ci.org/garbados/divan.png)](https://travis-ci.org/garbados/divan) [![Coverage Status](https://coveralls.io/repos/garbados/divan/badge.png)](https://coveralls.io/r/garbados/divan)

[wiki]: http://en.wikipedia.org/wiki/Divan_(furniture\)
[wiki_img]: http://upload.wikimedia.org/wikipedia/commons/e/ea/FrancisLevettLiotard.jpg

An effortless Cloudant interface for Python.

Put on your favorite hookah, sit back on the [divan][wiki], and relax.

![What a Divan Looks Like][wiki_img]

## Install

    pip install divan
    
## Usage

Cloudant and CouchDB expose REST APIs that map effortlessly into native Python objects. As much as possible, Divan uses native Python objects as shortcuts to the raw API, so that such convenience never obscures what's going on underneath. For example:

    import divan

    conn = divan.Connection()
    db = conn.database('test')
    same_db = conn['test']
    assert db.uri == same_db.uri
    # True

Divan expose raw interactions -- HTTP requests, etc. -- through special methods, so we provide syntactical sugar without obscuring the underlying API. Built-ins, such as `__getitem__`, act as Pythonic shortcuts to those methods. For example:

    import divan

    conn = divan.Connection()
    db = conn.database('test')
    doc = db.document('test_doc')
    # create the document
    resp = doc.put({
      '_id': 'hello_world',
      'herp': 'derp'
      })
    # delete the document
    rev = resp.json()['_rev']
    doc.delete(params={'rev': rev})
    # but this also creates a document
    db['hello_world'] = {'herp': 'derp'}

If CouchDB has a special endpoint for something, it's in Divan as a special method, so any special circumstances are taken care of automagically. For example:

    import divan

    conn = divan.Connection()
    db = conn.database('test')
    view = db.all_docs() # returns all docs in the database
    for doc in db:
      # iterates over every doc in the database
      pass
    for doc in view:
      # and so does this!
      pass

### Object Hierarchy

You can create objects explicitly or inherit them from objects higher in the DB hierarchy. So, you can create a `Database` object explicitly, or use `Connection.database` to inherit settings from the `Connection` object. For example:

    import divan

    conn = divan.Connection()
    db = conn.database('test')
    doc = db.document('test_doc')
    otherdoc = divan.Document('http://localhost:5984/test/test_doc')
    assert doc.uri == otherdoc.uri
    # True

### Errors

All methods return response objects generated by Requests, if the request was successful. Else, the response object is attached to the thrown error. If a response has a bad status code, Divan throws an error. For example:

    import divan

    conn = divan.Connection()
    # connect to a database that doesn't exist
    db = conn.database('test')
    doc = db.document('doesnotexist')
    doc.put({
      'this_will': 'throw_an_error'
      })
    # throws divan.error.NotFoundError

Where possible, Divan errors inherit from built-in errors, so you can catch them more naturally. To wit:

* `NotFoundError` inherits from `LookupError`
* `BadRequestError` inherits from `SyntaxError`
* `MethodNotAllowedError` inherits from `AttributeError`
* `ConflictError` and `PreconditionError` inherit from `AssertionError`

All Divan errors also inherit from `DivanException`.

## API
- [Connection](#Connection)
    - [Connection.active_tasks](#Connection.active_tasks)
    - [Connection.all_dbs](#Connection.all_dbs)
    - [Connection.database](#Connection.database)
    - [Connection.delete](#Connection.delete)
    - [Connection.get](#Connection.get)
    - [Connection.info](#Connection.info)
    - [Connection.login](#Connection.login)
    - [Connection.logout](#Connection.logout)
    - [Connection.post](#Connection.post)
    - [Connection.put](#Connection.put)
    - [Connection.replicate](#Connection.replicate)
    - [Connection.session](#Connection.session)
    - [Connection.uuids](#Connection.uuids)
- [Database](#Database)
    - [Database.all_docs](#Database.all_docs)
    - [Database.changes](#Database.changes)
    - [Database.delete](#Database.delete)
    - [Database.document](#Database.document)
    - [Database.get](#Database.get)
    - [Database.missing_revs](#Database.missing_revs)
    - [Database.post](#Database.post)
    - [Database.put](#Database.put)
    - [Database.revs_diff](#Database.revs_diff)
    - [Database.save_docs](#Database.save_docs)
    - [Database.view_cleanup](#Database.view_cleanup)
- [Document](#Document)
    - [Document.attachment](#Document.attachment)
    - [Document.delete](#Document.delete)
    - [Document.get](#Document.get)
    - [Document.merge](#Document.merge)
    - [Document.post](#Document.post)
    - [Document.put](#Document.put)
    - [Document.view](#Document.view)
- [View](#View)
    - [View.delete](#View.delete)
    - [View.get](#View.get)
    - [View.post](#View.post)
    - [View.put](#View.put)
- [Attachment](#Attachment)
    - [Attachment.delete](#Attachment.delete)
    - [Attachment.get](#Attachment.get)
    - [Attachment.post](#Attachment.post)
    - [Attachment.put](#Attachment.put)

<a name="Connection"></a>
### Connection(uri, **kwargs)

<a name="Connection.active_tasks"></a>
#### Connection.active_tasks(**kwargs)

List replication, compaction, and indexer tasks currently running.

<a name="Connection.all_dbs"></a>
#### Connection.all_dbs(**kwargs)

List all databases.

<a name="Connection.database"></a>
#### Connection.database(name, **kwargs)

Create a `Database` object prefixed with this connection's URL.

<a name="Connection.delete"></a>
#### Connection.delete(path, **kwargs)

Make a DELETE request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="Connection.get"></a>
#### Connection.get(path, **kwargs)

Make a GET request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="Connection.info"></a>
#### Connection.info(**kwargs)

Return information about your CouchDB / Cloudant instance.

<a name="Connection.login"></a>
#### Connection.login(username, password, **kwargs)

Authenticate the connection via cookie.

<a name="Connection.logout"></a>
#### Connection.logout(**kwargs)

De-authenticate the connection's cookie.

<a name="Connection.post"></a>
#### Connection.post(path, **kwargs)

Make a POST request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.

<a name="Connection.put"></a>
#### Connection.put(path, **kwargs)

Make a PUT request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.

<a name="Connection.replicate"></a>
#### Connection.replicate(source, target, opts, **kwargs)

Begin a replication job.
`opts` contains replication options such as whether the replication
should create the target (`create_target`) or whether the replication
is continuous (`continuous`).

Note: unless continuous, will not return until the job is finished.

<a name="Connection.session"></a>
#### Connection.session(**kwargs)

Get current user's authentication and authorization status.

<a name="Connection.uuids"></a>
#### Connection.uuids(count, **kwargs)

Generate an arbitrary number of UUIDs.

<a name="Database"></a>
### Database(uri, **kwargs)

Connection to a specific database

<a name="Database.all_docs"></a>
#### Database.all_docs(**kwargs)

Return an iterator over all documents in the database.

<a name="Database.changes"></a>
#### Database.changes(**kwargs)

Gets a list of the changes made to the database. This can be used to monitor for update and modifications to the database for post processing or synchronization.

Automatically adjusts the request to handle the different response behavior of polling, longpolling, and continuous modes.

<a name="Database.delete"></a>
#### Database.delete(path, **kwargs)

Make a DELETE request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="Database.document"></a>
#### Database.document(name, **kwargs)

Create a `Document` object from `name`.

<a name="Database.get"></a>
#### Database.get(path, **kwargs)

Make a GET request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="Database.missing_revs"></a>
#### Database.missing_revs(revs, **kwargs)

<a name="Database.post"></a>
#### Database.post(path, **kwargs)

Make a POST request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.

<a name="Database.put"></a>
#### Database.put(path, **kwargs)

Make a PUT request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.

<a name="Database.revs_diff"></a>
#### Database.revs_diff(revs, **kwargs)

<a name="Database.save_docs"></a>
#### Database.save_docs(docs, **kwargs)

Save many docs, all at once.

<a name="Database.view_cleanup"></a>
#### Database.view_cleanup(**kwargs)

<a name="Document"></a>
### Document(uri, **kwargs)

<a name="Document.attachment"></a>
#### Document.attachment(name, **kwargs)

Create an `Attachment` object from `name` and the settings
for the current database.

<a name="Document.delete"></a>
#### Document.delete(path, **kwargs)

Make a DELETE request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="Document.get"></a>
#### Document.get(path, **kwargs)

Make a GET request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="Document.merge"></a>
#### Document.merge(docname, change, **kwargs)

Get document by `docname`, merge `changes`,
and then `PUT` the updated document back to the server

<a name="Document.post"></a>
#### Document.post(path, **kwargs)

Make a POST request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.

<a name="Document.put"></a>
#### Document.put(path, **kwargs)

Make a PUT request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.

<a name="Document.view"></a>
#### Document.view(method, function, **kwargs)

Create a `View` object by joining `method` and `function`.

<a name="View"></a>
### View(uri, **kwargs)

Methods for design documents

<a name="View.delete"></a>
#### View.delete(path, **kwargs)

Make a DELETE request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="View.get"></a>
#### View.get(path, **kwargs)

Make a GET request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="View.post"></a>
#### View.post(path, **kwargs)

Make a POST request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.

<a name="View.put"></a>
#### View.put(path, **kwargs)

Make a PUT request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.

<a name="Attachment"></a>
### Attachment(uri, **kwargs)

Attachment methods for a single document

<a name="Attachment.delete"></a>
#### Attachment.delete(path, **kwargs)

Make a DELETE request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="Attachment.get"></a>
#### Attachment.get(path, **kwargs)

Make a GET request against the object's URI joined
with `path`. `kwargs` are passed directly to Requests.

<a name="Attachment.post"></a>
#### Attachment.post(path, **kwargs)

Make a POST request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.

<a name="Attachment.put"></a>
#### Attachment.put(path, **kwargs)

Make a PUT request against the object's URI joined
with `path`.

`kwargs['params']` are turned into JSON before being
passed to Requests. If you want to indicate the message
body without it being modified, use `kwargs['data']`.


## Testing

To run Divan's tests, just do:

    python setup.py test

## Documentation

The API reference is automatically generated from the docstrings of each class and its methods. To install Divan with the necessary extensions to build the docs, do this:

    pip install -e divan[docs]

Then, in Divan's root directory, do this:
  
    python docs

Note: docstrings are in [Markdown](http://daringfireball.net/projects/markdown/).

## License

[MIT](http://opensource.org/licenses/MIT), yo.